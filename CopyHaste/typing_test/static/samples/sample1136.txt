
basepath = "mediawiki/extensions/"
gerrit_conf = {
	'host': 'gerrit.wikimedia.org',
	'port': '29418',
	'url': 'https://{host}/r/p/{project}.git'
	}
logging.basicConfig(level=logging.DEBUG)
log = logging.getLogger()
def main():
	log.info("Fetching projects
	projects = gerrit('ls-projects', ['-p', basepath]).splitlines()
	projects = [p for p in projects if '/' not in project_basename(p)]
	projects.sort()
	log.info("Checking modules")
	for p in projects:
		basename = project_basename(p)
		if not os.path.isdir(basename):
			log.info("Adding submodule for %s" % p)
			try:
				submodule_add(p)
			except subprocess.CalledProcessError:
				log.error("Git reported an issue adding module %s" % p)
	log.info("Rewriting .gitmodules")
	f = open('.gitmod