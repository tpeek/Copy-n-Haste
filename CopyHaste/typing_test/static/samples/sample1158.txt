
class StockItem(Item):
	url = Field()
class StockSingle(Spider):
	name = "simple"
	allowed_domains = ["stockq.org"]
	start_urls = ["http://www.stockq.org/stock/history/2009/09/20090901_tc.php"]
	
	def parse(self, response):
		file_name = 'test.csv'
		if not os.path.isfile(file_name):
			csvfile = open(file_name, 'wb')
			writer = unicodecsv.writer(csvfile, delimiter=',')
			error_flag = False
			for table in response.xpath('//table[@class="marketdatatable"]'):
				for tr in table.xpath('tr[position() > 1]'):
					row = []
					for td in tr.xpath('td/font'):
						print td
						tmp = ''
						if td.xpath('a/text()'):
							tmp = td.xpath('a/text()').extract()[0]
						elif td.xpath('font/text()'):
							tmp = td.xpath('font/text()').extr