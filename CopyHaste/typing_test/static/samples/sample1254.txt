
if PY3:
else:
ESC_SHELL  = '!'
ESC_SH_CAP = '!!'
ESC_HELP   = '?'
ESC_HELP2  = '??'
ESC_MAGIC  = '%'
ESC_MAGIC2 = '%%'
ESC_QUOTE  = ','
ESC_QUOTE2 = ';'
ESC_PAREN  = '/'
ESC_SEQUENCES = [ESC_SHELL, ESC_SH_CAP, ESC_HELP ,\
				 ESC_HELP2, ESC_MAGIC, ESC_MAGIC2,\
				 ESC_QUOTE, ESC_QUOTE2, ESC_PAREN ]
class InputTransformer(with_metaclass(abc.ABCMeta, object)):
	
	@abc.abstractmethod
	def push(self, line):
		pass
	
	@abc.abstractmethod
	def reset(self):
		pass
	
	@classmethod
	def wrap(cls, func):
		@functools.wraps(func)
		def transformer_factory(**kwargs):
			return cls(func, **kwargs)
		
		return transformer_factory
class StatelessInputTransformer(InputTransformer):
	def __init__(self, func):
		self.func = func
	
	def __repr__(self):
		r