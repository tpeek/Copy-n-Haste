
try:
	urlquote = urlparse.quote
	urlunquote = urlparse.unquote
except ImportError:
	urlquote = urllib2.quote
	urlunquote = urllib2.unquote
try:
except ImportError:
	def uredirector(hdlr):
		pass


class redirector(object):
	def __init__(self, conf):
		self.conf = conf
		self.logger = conf.logger
		self._bad302 = ap_filter()
		self.adblock = ap_filter()
		self.redirlst = []

	def redirect(self, hdlr):
		searchword = re.match(r'^http://([\w-]+)/$', hdlr.path)
		if searchword:
			q = searchword.group(1)
			if 'xn--' in q:
				q = q.encode().decode('idna')
			self.logger.debug('Match redirect rule addressbar-search')
			return 'https://www.google.com/search?q=%s&ie=utf-8&oe=utf-8' % urlquote(q.encode('utf-8'))
		for rul