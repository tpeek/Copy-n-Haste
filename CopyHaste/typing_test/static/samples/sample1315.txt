
class SingleInstance:
	def __init__(self, flavor_id=""):
		self.initialized = False
		basename = os.path.splitext(os.path.abspath(sys.argv[0]))[0].replace("/", "-").replace(":", "").replace("\\", "-") + '-%s' % flavor_id + '.lock'
		self.lockfile = os.path.normpath(tempfile.gettempdir() + '/' + basename)
		logger.debug("SingleInstance lockfile: " + self.lockfile)
		if sys.platform == 'win32':
			try:
				if os.path.exists(self.lockfile):
					os.unlink(self.lockfile)
				self.fd = os.open(self.lockfile, os.O_CREAT | os.O_EXCL | os.O_RDWR)
			except OSError:
				type, e, tb = sys.exc_info()
				if e.errno == 13:
					logger.error("Another instance is already running, quitting.")
					sys.exit(-1)
				print(e.errno)
				raise
		else:
			self