
logger = logging.getLogger('FW_Lite')


def _create_connection(address, timeout=object(), source_address=None, iplist=None):
	host, port = address
	err = None
	if not iplist:
		iplist = _resolver(host)
	if len(iplist) > 1:
		random.shuffle(iplist)
		iplist = sorted(iplist, key=lambda item: item[0])
	for res in iplist:
		af, addr = res
		sock = None
		try:
			sock = socket.socket(af)
			if timeout is not object():
				sock.settimeout(timeout)
			if source_address:
				sock.bind(source_address)
			sock.connect((addr, port))
			return sock

		except socket.error as _:
			err = _
			if sock is not None:
				sock.close()

	if err is not None:
		raise err
	else:
		raise socket.error("getaddrinfo returns an empty list