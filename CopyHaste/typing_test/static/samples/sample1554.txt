
def error_and_exit(cmd, starting_path):
	print "Failed: %s" % cmd
	print os.getcwd()
	os.chdir(starting_path)
	sys.exit(1)
def main(starting_path):
	curpath = os.getcwd()
	mount = os.popen("mount | grep %s | grep os-base" % curpath).readlines()
	for dir in mount:
		os.system("umount -f %s" % dir.split(" ")[2])
	for objdir in "objs" "os-base":
		if os.path.exists(objdir):
			cmd = "chflags -R noschg %s" % (objdir)
			ret = os.system(cmd)
			if ret:
				error_and_exit(cmd, starting_path)
			cmd = "rm -rf %s" % (objdir)
			ret = os.system(cmd)
			if ret:
				error_and_exit(cmd, starting_path)
	os.chdir(starting_path)
if __name__ == "__main__":
	starting_path = os.getcwd()
	os.chdir(os.path.dirname(os.path.realpath(__file__)))
	os.chdir("..")
