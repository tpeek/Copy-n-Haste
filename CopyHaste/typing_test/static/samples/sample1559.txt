
def initial_setup():
	atexit.register(exit_handler)
	progname = os.path.basename(os.path.splitext(sys.argv[0])[0])
	syslog.openlog(progname, syslog.LOG_PID)
def exit_handler():
	syslog.syslog(syslog.LOG_WARNING, 'Closing log')
	syslog.closelog()
def sighandler(sig, stack):
	syslog.syslog(syslog.LOG_WARNING, 'Exiting on signal = %d..' % (sig, ))
	sys.exit(128 + signal.SIGTERM)
def main_loop():
	while True:
		syslog.syslog(syslog.LOG_WARNING, 'In main')
		time.sleep(5)
def main(argv):
	context = daemon.DaemonContext(
		working_directory='/tmp/test-daemon/wd',
		umask=0o002,
		pidfile=lockfile.FileLock('/tmp/test-daemon/test-daemon.pid'),
	)
	context.signal_map = {
		signal.SIGTERM: sighandler,
		signal.SIGHUP:  'terminate',
		}
	initial_setu