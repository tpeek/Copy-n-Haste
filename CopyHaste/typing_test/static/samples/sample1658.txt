
class FreeBSDPackage(Bcfg2.Client.Tools.PkgTool):
	name = 'FreeBSDPackage'
	__execs__ = ['/usr/sbin/pkg_add', '/usr/sbin/pkg_info']
	__handles__ = [('Package', 'freebsdpkg')]
	__req__ = {'Package': ['name', 'version']}
	pkgtool = ('/usr/sbin/pkg_add -r %s', ('%s-%s', ['name', 'version']))
	pkgtype = 'freebsdpkg'
	def RefreshPackages(self):
		self.installed = {}
		packages = self.cmd.run("/usr/sbin/pkg_info -a -E").stdout.splitlines()
		pattern = re.compile(r'(.*)-(\d.*)')
		for pkg in packages:
			if pattern.match(pkg):
				name = pattern.match(pkg).group(1)
				version = pattern.match(pkg).group(2)
				self.installed[name] = version
	def VerifyPackage(self, entry, _):
		if 'version' not in entry.attrib:
			self.logger.info("Cannot verify 