
app = Flask(__name__)
PRODUCTION_DOMAIN = 'readthedocs.org'
@app.route('/')
def redirect_front():
	version = 'latest'
	language = 'en'
	single_version = False
	SUBDOMAIN = CNAME = False
	print "Got request {host}".format(host=request.host)
	if PRODUCTION_DOMAIN in request.host:
		SUBDOMAIN = True
		slug = request.host.split('.')[0]
		path = "/home/docs/checkouts/readthedocs.org/user_builds/{slug}/metadata.json".format(slug=slug)
	else:
		try:
			cname = request.host.split(':')[0]
		except:
			cname = request.host
		CNAME = True
		path = "/home/docs/checkouts/readthedocs.org/cnametoproject/{cname}/metadata.json".format(cname=cname)
	try:
		json_obj = json.load(file(path))
		version = json_obj['version']
		language = json_obj['language']
		s