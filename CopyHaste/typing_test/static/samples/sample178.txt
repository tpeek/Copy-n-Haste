
TRANSACTION_METHODS = {
	'set',
	'increment',
	'decrement',
	'remove',
	'rename',
	'expire',
	'set_add',
	'set_remove',
	'set_pop',
	'list_lpush',
	'list_rpush',
	'list_lpop',
	'list_rpop',
	'list_remove',
	'dict_set',
	'dict_remove',
}
CHANNEL_TTL = 120
CHANNEL_BUFFER = 128
class TunlDB(object):
	def __init__(self):
		self._path = None
		self._set_queue = Queue.Queue()
		self._data = collections.defaultdict(
			lambda: {'ttl': None, 'val': None})
		self._timers = {}
		self._channels = collections.defaultdict(
			lambda: {'subs': set(), 'msgs': collections.deque(
				maxlen=CHANNEL_BUFFER), 'timer': None})
		self._commit_log = []
		self._locks = collections.defaultdict(threading.Lock)
	def _put_queue(self):
		if self._path:
			self._set_qu