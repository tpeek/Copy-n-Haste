
class TestKeyMgt(unittest.TestCase):
	def test_generate_keyini(self):
		ignored, filename = tempfile.mkstemp()
		try:
			os.chmod(filename, 0o664)
			generate_keyini(filename)
			config = ConfigParser.ConfigParser()
			config.read(filename)
			self.assertTrue(config.has_section('general'))
			perms = oct(os.stat(filename).st_mode)[4:]
			self.assertEqual(perms, '600')
		finally:
			os.remove(filename)
	def test_ensure_session_keys(self):
		ignored, filename = tempfile.mkstemp()
		os.remove(filename)
		settings = {'session.keyini': filename}
		ensure_session_keys(settings)
		key = settings.get('session.validate_key', None)
		self.assertTrue(key is not None)
		ensure_session_keys(settings)
		self.assertEqual(key, settings['session.validate_k