
class DGPSModule(mp_module.MPModule):
	def __init__(self, mpstate):
		super(DGPSModule, self).__init__(mpstate, "DGPS", "DGPS injection support")
		self.portnum = 13320
		self.port = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
		self.port.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)
		self.port.bind(("127.0.0.1", self.portnum))
		mavutil.set_close_on_exec(self.port.fileno())
		self.port.setblocking(0)
		print "Listening for DGPS packets on UDP://%s:%s" % ("127.0.0.1", self.portnum)
	def idle_task(self):
		try:
			data = self.port.recv(200)
		except socket.error as e:
			if e.errno in [ errno.EAGAIN, errno.EWOULDBLOCK ]:
				return
			raise
		if len(data) > 110:
			print("DGPS data too large: %u bytes" % len(data))
			return
	