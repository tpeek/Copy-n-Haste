
@ensure_csrf_cookie
def home(request):
	if request.user.is_authenticated() and request.user.is_active:
		profile = request.user.get_profile()
		if profile.has_chapter():
			return HttpResponseRedirect(reverse('petri.chapter.views.home', kwargs={
				'chapter': profile.chapter.slug
			}))
	if request.method == "POST":
		form = FrontpageApplyForm(request.POST)
		if form.is_valid():
			data = form.cleaned_data
			request.session['apply_username'] = data['username']
			request.session['apply_email'] = data['email']
			request.session['apply_password'] = data['password']
			return redirect('/accounts/apply')
	else:
		form = FrontpageApplyForm()
	return render_to_response('home.jade',
							{'form': form,
							 'current_user': request.user },
							context_instance=RequestContext(request))
def chapters(request):
	chapters = Chapter.objects.all()
	return render_to_response('chapter/chapters.jade',
							  {'chapters': chapters},
							  context_instance=RequestContext(request))
