
try:
	if 'TRAC_ENV' not in os.environ and \
	   'TRAC_ENV_PARENT_DIR' not in os.environ:
		os.environ['TRAC_ENV'] = '/home/zulip/trac'
	if 'PYTHON_EGG_CACHE' not in os.environ:
		if 'TRAC_ENV' in os.environ:
			egg_cache = os.path.join(os.environ['TRAC_ENV'], '.egg-cache')
		elif 'TRAC_ENV_PARENT_DIR' in os.environ:
			egg_cache = os.path.join(os.environ['TRAC_ENV_PARENT_DIR'], 
									 '.egg-cache')
		pkg_resources.set_extraction_path(egg_cache)
	cgi_frontend.run()
except SystemExit:
	raise
except Exception, e:
	print>>sys.stderr, e
	traceback.print_exc(file=sys.stderr)
	print 'Status: 500 Internal Server Error'
	print 'Content-Type: text/plain'
	print
	print 'Oops...'
	print
	print 'Trac detected an internal error:', e
	print
	traceback.print_exc(file=sys.stdout)
