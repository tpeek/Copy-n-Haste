dstaddr=sys.argv[1]
pid=os.getpid()
payload="a" * 1452
p=(Ether(src=SRC_MAC, dst=PF_MAC)/IPv6(src=SRC_OUT6, dst=dstaddr)/
	ICMPv6EchoRequest(id=pid, data=payload))
echocksum=IPv6(str(p.payload)).payload.cksum
print "echocksum=%
a=srp1(p, iface=SRC_IF, timeout=2)
if a and a.type == ETH_P_IPV6 and \
	ipv6nh[a.payload.nh] == 'ICMPv6' and \
	icmp6types[a.payload.payload.type] == 'Packet too big':
	outercksum=a.payload.payload.cksum
	print "outercksum=%
	q=a.payload.payload.payload
	if ipv6nh[q.nh] == 'ICMPv6' and \
		icmp6types[q.payload.type] == 'Echo Request':
		innercksum=q.payload.cksum
		print "innercksum=%
		if innercksum == echocksum:
			exit(0)
		print "INNERCKSUM!=ECHOCKSUM"
		exit(1)
	print "NO INNER ECHO REQUEST"
	exit(2)
print "NO PACKET TOO BIG"
exit(2)