def get_documents(year, input_directory, filename):
	global undef_count
	
	documents_list = []
	read_file = open(input_directory + str(year) + '/' + filename, 'r')
	line = read_file.readline()
	
	day, month = filename.split('.')[0].split('_')
	while line != '':
		if(line == '<DOC>\n'):
			document = []
			document.append(day + ' ' + month + ' ' + str(year))
			line = read_file.readline()
			if line.startswith('<DOC_NAME>'):
				line = line[10:]
			if line.endswith('</DOC_NAME>\n'):
				line = line[:-12]
		   
			document.append(line)
			topic = ''
			read_file.readline()
			
			line = read_file.readline().strip()
			parts = line.rsplit('Topics', 1)
			line = parts[0]
			if len(parts) == 1:
				topic = 'UNDEFINED'
				undef_count += 1
			else:
				topic = parts[1]
			read_file.readline()
			line = clean_line(line)
			document.append(line)
			
			topic = clean_topics(topic)
			document.append(topic)
			read_file.readline()
			documents_list.append(document)
			line = read_file.readline()
		
		else:
			print('Should never get here!\n')
			exit(1)
	read_file.close()
	return documents_list
def clean_topics(topic):
	global topics
	clean_topic = topic.rsplit('First posted')[0]
	clean_topic = clean_topic.rsplit('More stories')[0]
	clean_topic = ''.join(i for i in clean_topic if not i.isdigit())
	
	clean_topic = clean_topic.strip(' ')
	clean_topic = clean_topic.split(' ')[0]
	if clean_topic not in topics:
		topics.append(clean_topic)
	return clean_topic
def clean_line(line):
	source_split = line.rsplit('Source', 1)
	line = source_split[0]
	clean_line = ''.join([index for index in line if not index.isdigit()])
	clean_line = clean_line.lower()
	words_list = clean_line.split(' ')
	for word in words_list:
		if word in stopwords.words('english'):
			words_list.remove(word)
	
	clean_line = ' '.join(words_list)
	return clean_line
def main():
	global topics
	doc_count = 0
   
	input_directory = sys.argv[1]
	if not os.path.exists('clean.d/'):
		os.makedirs('clean.d/')
	for year in range(2003, 2004):
		if not os.path.exists('clean.d/' + str(year)):
			os.makedirs('clean.d/' + str(year))
		for filename in os.listdir(input_directory + str(year)):
			document_list = get_documents(year, input_directory, filename)
			doc_count += len(document_list)
			filedate, filename_suffix = filename.rsplit('.')
			filename_suffix = '.' + filename_suffix
			day, month = filedate.split('_')
			filename = month + '_' + day + filename_suffix
			new_file = open('clean.d/' + str(year) + '/' + filename, 'w')
			for document in document_list:
				new_file.write('<Topic>' + document[3] + '</Topic>\n')
				new_file.write('<Date>' + document[0] + '</Date>\n')
				new_file.write('<Title>' + document[1] + '</Title>\n')
				new_file.write('<Contents>' + document[2] + '</Contents>\n')
			new_file.close()
	print(str(doc_count) + '\n')
	print(topics)
	print(str(undef_count))
if __name__ == '__main__':
	topics = []
	undef_count = 0
	main()