sys.path.append( '../pymod' )
try:
except:
def proximity_1():
	try:
		x = gdal.ComputeProximity
		gdaltest.have_ng = 1
	except:
		gdaltest.have_ng = 0
		return 'skip'
	drv = gdal.GetDriverByName( 'GTiff' )
	src_ds = gdal.Open('data/pat.tif')
	src_band = src_ds.GetRasterBand(1)
	
	dst_ds = drv.Create('tmp/proximity_1.tif', 25, 25, 1, gdal.GDT_Byte )
	dst_band = dst_ds.GetRasterBand(1)
	
	gdal.ComputeProximity( src_band, dst_band )
	cs_expected = 1941
	cs = dst_band.Checksum()
	
	dst_band = None
	dst_ds = None
	if cs == cs_expected \
	   or gdal.GetConfigOption( 'CPL_DEBUG', 'OFF' ) != 'ON':
		drv.Delete( 'tmp/proximity_1.tif' )
	
	if cs != cs_expected:
		print('Got: ', cs)
		gdaltest.post_reason( 'got wrong checksum' )
		return 'fail'
	else:
		return 'success'
def proximity_2():
	try:
		x = gdal.ComputeProximity
		gdaltest.have_ng = 1
	except:
		gdaltest.have_ng = 0
		return 'skip'
	drv = gdal.GetDriverByName( 'GTiff' )
	src_ds = gdal.Open('data/pat.tif')
	src_band = src_ds.GetRasterBand(1)
	
	dst_ds = drv.Create('tmp/proximity_2.tif', 25, 25, 1, gdal.GDT_Float32 )
	dst_band = dst_ds.GetRasterBand(1)
	
	gdal.ComputeProximity( src_band, dst_band,
						   options = [ 'VALUES=65,64',
									   'MAXDIST=12',
									   'NODATA=-1',
									   'FIXED_BUF_VAL=255' ] )
	cs_expected = 3256
	cs = dst_band.Checksum()
	
	dst_band = None
	dst_ds = None
	if cs == cs_expected \
	   or gdal.GetConfigOption( 'CPL_DEBUG', 'OFF' ) != 'ON':
		drv.Delete( 'tmp/proximity_2.tif' )
	
	if cs != cs_expected:
		print('Got: ', cs)
		gdaltest.post_reason( 'got wrong checksum' )
		return 'fail'
	else:
		return 'success' 
gdaltest_list = [
	proximity_1,
	proximity_2
	]
if __name__ == '__main__':
	gdaltest.setup_run( 'proximity' )
	gdaltest.run_tests( gdaltest_list )
	gdaltest.summarize()