sys.path.append( '../pymod' )
def bag_1():
	try:
		gdaltest.bag_drv = gdal.GetDriverByName( 'BAG' )
	except:
		gdaltest.bag_drv = None
		return 'skip'
	return 'success'
def bag_2():
	if gdaltest.bag_drv is None:
		return 'skip'
	ds = gdal.Open( 'data/true_n_nominal.bag' )
	cs = ds.GetRasterBand(1).Checksum()
	if cs != 1072:
		gdaltest.post_reason( 'Wrong checksum on band 1, got %d.' % cs )
		return 'fail'
	
	cs = ds.GetRasterBand(2).Checksum()
	if cs != 150:
		gdaltest.post_reason( 'Wrong checksum on band 2, got %d.' % cs )
		return 'fail'
	
	cs = ds.GetRasterBand(3).Checksum()
	if cs != 1315:
		gdaltest.post_reason( 'Wrong checksum on band 3, got %d.' % cs )
		return 'fail'
	b1 = ds.GetRasterBand(1)
	if abs(b1.GetMinimum()-10) > 0.01:
		gdaltest.post_reason( 'band 1 minimum wrong.' )
		return 'fail'
	
	if abs(b1.GetMaximum()-19.8) > 0.01:
		gdaltest.post_reason( 'band 1 maximum wrong.' )
		return 'fail'
	
	if abs(b1.GetNoDataValue()-1000000.0) > 0.1:
		gdaltest.post_reason( 'band 1 nodata wrong.' )
		return 'fail'
	b2 = ds.GetRasterBand(2)
	if abs(b2.GetNoDataValue()-0.0) > 0.1:
		gdaltest.post_reason( 'band 2 nodata wrong.' )
		return 'fail'
	b3 = ds.GetRasterBand(3)
	if abs(b3.GetNoDataValue()-1000000.0) > 0.1:
		gdaltest.post_reason( 'band 3 nodata wrong.' )
		return 'fail'
	xmlBag = ds.GetMetadata('xml:BAG')[0]
	if xmlBag.find('<?xml') != 0:
		gdaltest.post_reason( 'did not get xml:BAG metadata' )
		print(xmlBag)
		return 'fail'
	return 'success'
gdaltest_list = [ bag_1,
				  bag_2 ]
if __name__ == '__main__':
	gdaltest.setup_run( 'hdf5' )
	gdaltest.run_tests( gdaltest_list )
	gdaltest.summarize()