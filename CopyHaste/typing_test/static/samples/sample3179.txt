args = sys.argv
if len(args) < 3:
	sys.stderr.write("Usage: python " + args[0] + " <groundTruthClusterFile> "
		+ " <predictedClusterFile> (output on stdout)\n")
	sys.exit(-1)
clusterMap = {}
gtMap = {}
gtCounts = []
clusterCounts = []
gtClusterCounts = {}
gtAssignments = {}
regexp = re.compile("\\s+")
lineNo = 1
for line in file(args[1],"r"):
	t = regexp.split(line.strip())
	if len(t) > 1:
		id = int(t[0])
		gtc = int(t[1])
	else:
		gtc = int(t[0])
		id = lineNo
	if gtc not in gtMap:
		gtMap[gtc] = len(gtMap)
		gtCounts.append(0)
	gtCounts[gtMap[gtc]] = gtCounts[gtMap[gtc]]+1
	gtAssignments[id] = gtMap[gtc]
	lineNo = lineNo+1
lineNo = 1
N_cluster = 0
for line in file(args[2],"r"):
	t = regexp.split(line.strip())
	if len(t) > 1:
		id = int(t[0])
		cass = int(t[1])
	else:
		id = lineNo
		cass = int(t[0])
	if id in gtAssignments:
		if cass not in clusterMap:
			clusterMap[cass] = len(clusterMap)
			clusterCounts.append(0)
		cmapass = clusterMap[cass]
		clusterCounts[cmapass] = clusterCounts[cmapass]+1
		N_cluster = N_cluster+1
		gtass = gtAssignments[id]
		if gtass not in gtClusterCounts:
			gtClusterCounts[gtass] = {}
		if cmapass not in gtClusterCounts[gtass]:
			gtClusterCounts[gtass][cmapass] = 0
		gtClusterCounts[gtass][cmapass] = gtClusterCounts[gtass][cmapass]+1
	lineNo = lineNo+1
mi = 0
N_gt = float(len(gtAssignments))
N = N_gt
logN = math.log(N,2)
logN_cluster = math.log(float(N_cluster),2)
h_gtc = 0
h_cluster = 0
for gtc in gtClusterCounts:
	gtcc = gtClusterCounts[gtc]
	gtcCount = math.log(float(gtCounts[gtc]),2)
	for cluster in gtcc:
		clusterCount = float(clusterCounts[cluster])
		gtccCount = float(gtcc[cluster])
		t = gtccCount/N
		u = logN+math.log(gtccCount,2)-gtcCount-math.log(clusterCount,2)
		mi = mi+t*u
for cCount in clusterCounts:
	cCount = float(cCount)
	h_cluster = h_cluster+(cCount/N_cluster)*(logN_cluster-math.log(cCount,2))
for gtCount in gtCounts:
	gtCount = float(gtCount)
	h_gtc = h_gtc+(gtCount/N)*(logN-math.log(gtCount,2))
nmi = mi*2/(h_gtc+h_cluster)
print 'Norm. Mutual Information: %.4f'%(nmi)
print 'Mutual Information: %.4f'%(mi)
print 'Entropy of Ground Truth Clustering: %.4f'%(h_gtc)
print 'Entropy of Predicted Clustering: %.4f'%(h_cluster)