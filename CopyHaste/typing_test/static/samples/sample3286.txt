_ = L10n.get_translation()
(options, argv) = Options.fpdb_options()
if options.config:
	config = Configuration.Config(options.config)
else:
	config = Configuration.Config()
filter = options.hhc
filter_name = filter.replace("ToFpdb", "")
mod = __
obj = getattr(mod, filter_name, None)
hhc = obj(config, autostart=False)
for kodec in ("utf8", "cp1252", "utf-16"):
	if os.path.exists(options.filename):
		in_fh = codecs.open(options.filename, 'r', kodec)
		filecontents = in_fh.read()
		in_fh.close()
		break
	else:
		print(_("Could not find file %s") % options.filename)
		exit(1)
m = hhc.re_PlayerInfo.finditer(filecontents)
outfile = options.filename+".anon"
print(_("Output being written to %s") % outfile)
savestdout = sys.stdout
fsock = open(outfile,"w")
sys.stdout = fsock
players = []
for a in m:
	players = players + [a.group('PNAME')]
uniq = set(players)
for i, name in enumerate(uniq):
	filecontents = filecontents.replace(name, 'Player%d' %i)
print(filecontents)
sys.stdout = savestdout
fsock.close()