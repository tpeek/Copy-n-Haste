log = logging.getLogger('urlrewrite')
class UrlRewrite(object):
	resolves = {}
	schema = {
		'type': 'object',
		'additionalProperties': {
			'type': 'object',
			'properties': {
				'regexp': {'type': 'string', 'format': 'regex'},
				'format': {'type': 'string'}
			},
			'required': ['regexp', 'format'],
			'additionalProperties': False
		}
	}
	def on_task_start(self, task, config):
		resolves = self.resolves[task.name] = {}
		for name, rewrite_config in config.iteritems():
			match = re.compile(rewrite_config['regexp'])
			format = rewrite_config['format']
			resolves[name] = {'regexp_compiled': match, 'format': format, 'regexp': rewrite_config['regexp']}
			log.debug('Added rewrite %s' % name)
	def url_rewritable(self, task, entry):
		l