g_module_context = None
class MMapModule(mp_module.MPModule):
	def __init__(self, mpstate):
		super(MMapModule, self).__init__(mpstate, 'mmap', 'modest map display')
		self.lat = None
		self.lon = None
		self.alt = None
		self.speed = None
		self.airspeed = None
		self.groundspeed = None
		self.heading = 0
		self.wp_change_time = 0
		self.fence_change_time = 0
		self.server = None
		self.server = mmap_server.start_server('127.0.0.1', port=9999, module_state=self)
		webbrowser.open('http://127.0.0.1:9999/', autoraise=True)
	
	def unload(self):
		self.server.terminate()
	
	def mavlink_packet(self, m):
		if m.get_type() == 'GPS_RAW':
			(self.lat, self.lon) = (m.lat, m.lon)
		elif m.get_type() == 'GPS_RAW_INT':
			(self.lat, self.lon) = (m.lat