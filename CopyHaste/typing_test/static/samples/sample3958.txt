django.setup()
r = RedisQueueServer('builder')
def buildupgrade(msg):
  print "starting upgrade"
  planets = Planet.objects.filter(id=msg['planetid'])
  userid = msg['userid'] 
  upgrade = msg['upgrade']
  if len(planets):
	curplanet = planets[0]
	if curplanet.owner_id == userid:
	  curplanet.startupgrade(upgrade,True)
	  return 1
  return 0
def scrapupgrade(msg):
  django.db.connection.queries=[]
  print "scrapping upgrade"
  planets = Planet.objects.filter(id=msg['planetid'])
  userid = msg['userid']
  upgrade = msg['upgrade']
  if len(planets):
	curplanet = planets[0]
	if curplanet.owner_id == userid:
	  scrapupgrade = PlanetUpgrade.objects\
								  .filter(planet=curplanet, 
										  instrumentality__type=int(upgrade))\
								  .