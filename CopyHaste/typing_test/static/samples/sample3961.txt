cursor = connection.cursor()
localcache['upgrades']	= allupgrades()
localcache['attributes']  = allattributes()
localcache['players']	 = allplayers()
localcache['costs']	   = {}
for fleet in Fleet.objects\
				  .filter(pirated__gt=0)\
				  .iterator():
  fleet.pirated -= 1
  fleet.save()
for i in PlayerAttribute.objects\
						.filter(attribute='recent-transfers')\
						.exclude(value="0"):
  val = int(i.value)
  val = max(0,val-1)
  i.value = str(val)
  i.save()
print "planet sensor ranges..."
for planet in Planet.objects\
					.exclude(owner=None)\
					.select_related('resources')\
					.iterator():
  planet.calculatesenserange()
  if localcache['players'].has_key(planet.owner_id):
	lastactive = localcache['players'][planet.owner_id][