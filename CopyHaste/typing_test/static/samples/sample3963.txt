counter = 0
print "loading tables"
localcache['upgrades']	   = allupgrades()
localcache['attributes']	 = allattributes()
localcache['connections']	= allconnections()
localcache['competition']	= allcompetition()
localcache['players']		= allplayers()
localcache['planets']		= allplanetsbysector()
localcache['costs']		  = {}
localcache['planetarrivals'] = {}
localcache['arrivals']	   = []
print "done"
f = Fleet.objects\
		 .filter(Q(merchantmen__gt=0)|Q(bulkfreighters__gt=0))\
		 .select_related('owner','destination','trade_manifest',
						 'route','homeport','destination','source')
total = f.count()
for i in f.iterator():
  counter += 1
  if i.destination and i.source and \
	 i.x==i.dx and i.y==i.dy and \
	 i.disposition==8 and \
	 i.speed==0