class Percolator:
	def __init__(self, text):
		self.text = text
		self.redir = WidgetRedirector(text)
		self.top = self.bottom = Delegator(text)
		self.bottom.insert = self.redir.register("insert", self.insert)
		self.bottom.delete = self.redir.register("delete", self.delete)
		self.filters = []
	def close(self):
		while self.top is not self.bottom:
			self.removefilter(self.top)
		self.top = None
		self.bottom.setdelegate(None); self.bottom = None
		self.redir.close(); self.redir = None
		self.text = None
	def insert(self, index, chars, tags=None):
		self.top.insert(index, chars, tags)
	def delete(self, index1, index2=None):
		self.top.delete(index1, index2)
	def insertfilter(self, filter):
		assert isinstance(filter, Delegator)
		assert f