sys.path.append(os.path.join(os.path.dirname(__file__), '..', '..'))
	su_to_zulip
logging.basicConfig(format="%(asctime)s upgrade-zulip: %(message)s",
					level=logging.INFO)
if os.getuid() != 0:
	logging.error("Must be run as root.")
	sys.exit(1)
if len(sys.argv) != 2:
	print FAIL + "Usage: %s <tarball>" % (sys.argv[0],) + ENDC
	sys.exit(1)
tarball_path = sys.argv[1]
start_time = time.time()
got_lock = False
while time.time() - start_time < 300:
	try:
		os.mkdir(LOCK_DIR)
		got_lock = True
		break
	except OSError:
		print WARNING + "Another deployment in progress; waiting for lock... (If no deployment is running, rmdir %s)" % (LOCK_DIR,) + ENDC
		time.sleep(10)
if not got_lock:
	print FAIL + "Deployment already in progress.  Please run\n"