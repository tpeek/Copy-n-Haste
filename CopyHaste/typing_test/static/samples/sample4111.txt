db_connect, db_queue, TASK_QUEUE, DONE_QUEUE, DUE_QUEUE, load_config,
	pop_task_
	)
def main():
	setup_logger(environ.get('AWS_SNS_ARN'))
	config = load_config()
	checkin_time = time()
	try:
		cw = connect_cloudwatch()
	except:
		cw = False
	
	while True:
		try:
			with db_connect(config['DATABASE_URL']) as conn:
				task_Q = db_queue(conn, TASK_QUEUE)
				done_Q = db_queue(conn, DONE_QUEUE)
				due_Q = db_queue(conn, DUE_QUEUE)
				pop_task_
				pop_task_
			
				if time() < checkin_time:
					continue
				task_n, done_n, due_n = map(len, (task_Q, done_Q, due_Q))
				_L.info('Queue lengths: {task_n} tasks, {done_n} done, {due_n} due'.format(**locals()))
				
				if cw:
					cw.put_metric_data('openaddr.ci', 'tasks queue', task_n, unit='Cou