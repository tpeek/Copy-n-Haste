db_connect, db_queue, db_queue, pop_task_
	MAGIC_OK_MESSAGE, DONE_QUEUE, TASK_QUEUE, DUE_QUEUE, setup_logger
	)
def upload_file(s3, keyname, filename):
	key = s3.new_key(keyname)
	kwargs = dict(policy='public-read', reduced_redundancy=True)
	key.set_contents_
	url = key.generate_url(expires_in=0, query_auth=False, force_http=True)
	
	return url, key.md5
def do_work(s3, run_id, source_name, job_contents_b64, output_dir):
	"Do the actual work of running a source file in job_contents"
	workdir = tempfile.mkdtemp(prefix='work-', dir=output_dir)
	out_fn = os.path.join(workdir, 'user_input.txt')
	with open(out_fn, 'wb') as out_fp:
		out_fp.write(base64.b64decode(job_contents_b64))
	oa_dir = os.path.join(workdir, 'out')
	os.mkdir(oa_dir)
	cmd = 'o