comm = MPI.COMM_WORLD
rank = comm.rank
size = comm.size
root_dir = "../../tests/data/nogit/remd/"
fname = root_dir + "/remd.x.00" + str(rank)
top_name = root_dir + "myparm.top"
traj = io.load(fname, top_name)
n_atoms =  traj.top.n_atoms
n_frames = traj.n_frames
if rank == 0:
	ref = traj[0]
	ref_xyz = np.asarray(ref.xyz, dtype=np.float64)
else:
	ref = None
	ref_xyz = np.empty((n_atoms, 3), dtype=np.float64)
comm.Bcast([ref_xyz, MPI.DOUBLE])
if rank != 0:
	ref = Frame()
	ref.append_xyz(ref_xyz)
_ref = ref.copy()
def rmsd_mpi(traj, _ref):
	arr0 = pyca.calc_rmsd(traj, "@CA", top=traj.top, ref= _ref)
	return arr0
arr0 = rmsd_mpi(traj, _ref)
if rank == 0:
	data = np.empty(size * traj.n_frames, dtype=np.float64)
else:
	data = None
data = comm.gath