NetWorkIOError = (socket.error, ssl.SSLError, OpenSSL.SSL.Error, OSError)
def send_header(wfile, keyword, value):
	keyword = keyword.title()
	if keyword == 'Set-Cookie':
		for cookie in re.split(r', (?=[^ =]+(?:=|$))', value):
			wfile.write("%s: %s\r\n" % (keyword, cookie))
	elif keyword == 'Content-Disposition' and '"' not in value:
		value = re.sub(r'filename=([^"\']+)', 'filename="\\1"', value)
		wfile.write("%s: %s\r\n" % (keyword, value))
	elif keyword == "Alternate-Protocol":
		return
	else:
		wfile.write("%s: %s\r\n" % (keyword, value))
def fetch(method, host, path, headers, payload, bufsize=8192):
	request_data = '%s %s HTTP/1.1\r\n' % (method, path)
	request_data += ''.join('%s: %s\r\n' % (k, v) for k, v in headers.items())
	reque