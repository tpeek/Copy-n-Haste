STATUS_CHOICES = ('queued', 'in_progress', 'finished')
EXPANDERS = {
	CommandType.collect_steps: CommandsExpander,
	CommandType.collect_tests: TestsExpander,
}
class CommandDetailsAPIView(APIView):
	post_parser = RequestParser()
	post_parser.add_argument('status', choices=STATUS_CHOICES)
	post_parser.add_argument('return_code', type=int)
	post_parser.add_argument('date', type=ISODatetime())
	post_parser.add_argument('output', type=json.loads)
	def get(self, command_id):
		command = Command.query.get(command_id)
		if command is None:
			return '', 404
		return self.respond(command)
	def post(self, command_id):
		args = self.post_parser.parse_args()
		current_datetime = args.date or datetime.utcnow()
		if args.output or args.status == 'finish