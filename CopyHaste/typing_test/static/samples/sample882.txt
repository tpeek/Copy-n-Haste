
warp_spec = None
def warp():
	global warp_spec
	spec = warp_spec
	warp_spec = None
	if spec is None:
		return None
	if ':' not in spec:
		raise Exception('No : found in warp location.')
	filename, line = spec.split(':', 1)
	line = int(line)
	if not renpy.config.developer:
		raise Exception("Can't warp, developer mode disabled.")
	prev = { }
	workset = sets.Set([ n for n in renpy.game.script.namemap.itervalues() if isinstance(n, renpy.ast.Scene) ])
	seenset = sets.Set(workset)
	def add(node, next):
		if next not in seenset:
			seenset.add(next)
			workset.add(next)
			prev[next] = node
	while workset:
		n = workset.pop()
		if isinstance(n, renpy.ast.Menu):
			for i in n.items:
				if i[2] is not None:
					add(n, i[2][0])
		if isinstance(n,