
MemoRecord = namedtuple("MemoRecord", "key, task")
class DBPickler(pickle.Pickler):
	def persistent_id(self, obj):
		if isinstance(obj, MemoRecord):
			return ("MemoRecord", obj.key)
		else:
			return None
class DBUnpickler(pickle.Unpickler):
	def __init__(self, file, connection):
		super().__init__(file)
		self.connection = connection
	def persistent_load(self, pid):
		cursor = self.connection.cursor()
		type_tag, key_id = pid
		if type_tag == "MemoRecord":
			cursor.execute("SELECT * FROM memos WHERE key=?", (str(key_id),))
			key, task = cursor.fetchone()
			return MemoRecord(key, task)
		else:
			raise pickle.UnpicklingError("unsupported persistent object")
def main():
	conn = sqlite3.connect(":memory:")
	cursor = conn.cursor()
	cursor